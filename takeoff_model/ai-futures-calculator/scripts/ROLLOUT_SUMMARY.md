# Rollout Summary Tools

This directory contains tools for analyzing Monte Carlo rollout success and failure statistics.

## Quick Start

### Option 1: Shell Aliases (Recommended)

For convenience, source the aliases file:
```bash
source scripts/rollout_aliases.sh
```

Then use these convenient commands:
- `rollout-stats` - View statistics for all runs
- `rollout-summary <dir>` - View summary for a specific run
- `rollout-summary-latest` - View summary for the most recent run
- `rollout-list` - List all available rollout runs

To make these permanent, add to your `~/.bashrc` or `~/.zshrc`:
```bash
source /path/to/ai-futures-calculator/scripts/rollout_aliases.sh
```

### Option 2: Direct Python Scripts

### View all runs at a glance
```bash
python scripts/scan_all_rollouts.py
```

This scans all subdirectories in `outputs/` and displays a table showing:
- Total rollouts per run
- Number of successful rollouts
- Number of failed rollouts
- Number of timeouts
- Success rate percentage

### View detailed statistics for a specific run
```bash
python scripts/rollout_summary.py outputs/1105_daniel
```

This generates a detailed summary including:
- Total counts and success/failure rates
- Breakdown by error type (Timeout, Validation Error, etc.)
- First 10 error messages with sample IDs
- Saves summary to `rollout_summary.txt` in the run directory

### Automatic summary generation

When you run `python scripts/batch_rollout.py`, the rollout summary is **automatically generated** at the end of each run. You'll find `rollout_summary.txt` in the output directory alongside other analysis files.

## Output Files

### rollout_summary.txt
Created in each run directory (e.g., `outputs/1105_daniel/rollout_summary.txt`)

Example:
```
============================================================
ROLLOUT SUMMARY
============================================================

Total Rollouts:       1000
Successful:            958 (95.80%)
Failed:                 42 ( 4.20%)

FAILURE BREAKDOWN:
------------------------------------------------------------
  Other Error                       40 ( 4.00%)
  Timeout                            2 ( 0.20%)

FIRST 10 ERRORS:
------------------------------------------------------------
1. Sample ID 11: Other Error
   Error calculating metrics at t=2046.03...
```

### scan_all_rollouts.py output
Console output showing table of all runs:

```
====================================================================================================
ROLLOUT STATISTICS - ALL RUNS
====================================================================================================

Run Directory                     Total  Success   Failed  Timeout  Success %
----------------------------------------------------------------------------------------------------
1105_daniel                        1000      958       42        2     95.8%
1105_eli                           1000      955       45        7     95.5%
...
----------------------------------------------------------------------------------------------------
TOTAL                             16127    15786      341       92     97.9%
====================================================================================================
```

## Error Types

The tools categorize failures into:

- **Timeout**: Rollout exceeded time limit
- **Validation Error**: Parameter validation failed
- **Infeasible Parameters**: Parameters produced infeasible model state
- **Missing Results**: Rollout completed but no results were generated
- **Other Error**: Any other error type

## JSON Output

For programmatic access, use the `--json` flag:

```bash
python scripts/rollout_summary.py outputs/1105_daniel --json
```

This creates `rollout_summary.json` with structured data:
```json
{
  "total_rollouts": 1000,
  "successful_rollouts": 958,
  "failed_rollouts": 42,
  "timeout_rollouts": 2,
  "success_rate": 0.958,
  "failure_rate": 0.042,
  "error_types": {
    "Other Error": 40,
    "Timeout": 2
  },
  "error_details": [...]
}
```

## Integration with Batch Rollout

The rollout summary is automatically generated by `batch_rollout.py` along with:
1. Batch plots (milestone histograms)
2. Milestone summary table
3. **Rollout summary** (new!)

You can find the summary in each run's output directory immediately after completion.
